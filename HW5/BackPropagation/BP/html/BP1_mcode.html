<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">w_init</span>, <span class="var type1" id="S3T2U4">err_1</span>, <span class="var type1" id="S4T1U5">w_final</span>, <span class="var type1" id="S5T2U6">err_final</span>, <span class="var type1" id="S6T2U7">times</span>]=BP(<span class="var type1" id="S7T3U10">x</span>, <span class="var type1" id="S8T4U11">t</span>, <span class="var type1" id="S9T2U12">rate</span>, <span class="var type1" id="S10T5U13">max_times</span>, <span class="var type1" id="S11T2U14">target</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Initialize v's and w's</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T1:U11"><span class="var type1" id="S12T1U17">w</span> = <span class="mxinfo " id="T1:U13"><span class="mxinfo " id="T1:U14"><span class="mxinfo " id="T2:U15">2</span>*<span class="mxinfo " id="T1:U16">rand(1,2,<span class="string">'double'</span>)</span></span> - <span class="mxinfo " id="T2:U17">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T1:U18"><span class="var type1" id="S2T1U29">w_init</span> = <span class="var type1" id="S12T1U30">w</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T6:U21"><span class="var type1" id="S14T6U33">v</span> = <span class="mxinfo " id="T6:U23"><span class="mxinfo " id="T6:U24"><span class="mxinfo " id="T2:U25">2</span>*<span class="mxinfo " id="T6:U26">rand(2,2,<span class="string">'double'</span>)</span></span> - <span class="mxinfo " id="T2:U27">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T1:U28"><span class="var type1" id="S15T1U45">b</span> = <span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31"><span class="mxinfo " id="T2:U32">2</span>*<span class="mxinfo " id="T1:U33">rand(1,2,<span class="string">'double'</span>)</span></span> - <span class="mxinfo " id="T2:U34">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U35"><span class="var type1" id="S16T2U57">c</span> = <span class="mxinfo " id="T2:U37"><span class="mxinfo " id="T2:U38"><span class="mxinfo " id="T2:U39">2</span>*<span class="mxinfo " id="T2:U40">rand(1,1,<span class="string">'double'</span>)</span></span> - <span class="mxinfo " id="T2:U41">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T1:U42"><span class="var type1" id="S17T1U69">hnode</span> = <span class="mxinfo " id="T1:U44">zeros(<span class="mxinfo " id="T2:U45">1</span>,<span class="mxinfo " id="T2:U46">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T1:U47"><span class="var type1" id="S19T1U76">w_delta</span> = <span class="mxinfo " id="T1:U49">zeros(<span class="mxinfo " id="T2:U50">1</span>,<span class="mxinfo " id="T2:U51">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T6:U52"><span class="var type1" id="S20T6U83">v_delta</span> = <span class="mxinfo " id="T6:U54">zeros(<span class="mxinfo " id="T2:U55">2</span>,<span class="mxinfo " id="T2:U56">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T1:U57"><span class="var type1" id="S21T1U90">b_delta</span> = <span class="mxinfo " id="T1:U59">zeros(<span class="mxinfo " id="T2:U60">1</span>,<span class="mxinfo " id="T2:U61">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U62"><span class="var type1" id="S6T2U97">times</span> = <span class="mxinfo " id="T2:U64">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T2:U65"><span class="var type1" id="S3T2U101">err_1</span> = <span class="mxinfo " id="T2:U67">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T1:U68"><span class="var type1" id="S4T1U105">w_final</span> = <span class="mxinfo " id="T1:U70">zeros(<span class="mxinfo " id="T2:U71">1</span>,<span class="mxinfo " id="T2:U72">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T4:U73"><span class="var type1" id="S22T4U112">y</span> = <span class="mxinfo " id="T4:U75">zeros(<span class="mxinfo " id="T2:U76">1</span>,<span class="mxinfo " id="T2:U77">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T2:U78"><span class="var type1" id="S23T2U119">err</span> = <span class="mxinfo " id="T2:U80">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">% start traning</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S24T5U123">k</span>=<span class="mxinfo " id="T5:U82">1</span>:<span class="mxinfo " id="T5:U83">1</span>:<span class="var type1" id="S10T5U128">max_times</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T2:U85"><span class="var type1" id="S23T2U131">err</span> = <span class="mxinfo " id="T2:U87">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T1:U88"><span class="var type1" id="S19T1U135">w_delta</span> = <span class="mxinfo " id="T1:U90">zeros(<span class="mxinfo " id="T2:U91">1</span>,<span class="mxinfo " id="T2:U92">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T6:U93"><span class="var type1" id="S20T6U142">v_delta</span> = <span class="mxinfo " id="T6:U95">zeros(<span class="mxinfo " id="T2:U96">2</span>,<span class="mxinfo " id="T2:U97">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T1:U98"><span class="var type1" id="S21T1U149">b_delta</span> = <span class="mxinfo " id="T1:U100">zeros(<span class="mxinfo " id="T2:U101">1</span>,<span class="mxinfo " id="T2:U102">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T2:U103"><span class="var type1" id="S25T2U156">c_delta</span> = <span class="mxinfo " id="T2:U105">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S26T2U160">l</span> = <span class="mxinfo " id="T2:U107">1</span>:<span class="mxinfo " id="T2:U108">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        <span class="comment">% calculate hidden layer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T2:U109"><span class="mxinfo " id="T2:U110"><span class="var type1" id="S17T1U169">hnode</span>(<span class="mxinfo " id="T7:U112">1</span>,<span class="mxinfo " id="T7:U113">1</span>)</span> = <span class="mxinfo " id="T2:U114"><span class="fcn" id="F72N3:B173">f</span>(<span class="mxinfo " id="T2:U115"><span class="mxinfo " id="T2:U116"><span class="mxinfo " id="T2:U117"><span class="mxinfo " id="T2:U118"><span class="var type1" id="S14T6U178">v</span>(<span class="mxinfo " id="T7:U120">1</span>,<span class="mxinfo " id="T7:U121">1</span>)</span>*<span class="mxinfo " id="T2:U122"><span class="var type1" id="S7T3U182">x</span>(<span class="var type1" id="S26T2U183">l</span>,<span class="mxinfo " id="T2:U125">1</span>)</span></span> + <span class="mxinfo " id="T2:U126"><span class="mxinfo " id="T2:U127"><span class="var type1" id="S14T6U187">v</span>(<span class="mxinfo " id="T2:U129">2</span>,<span class="mxinfo " id="T2:U130">1</span>)</span>*<span class="mxinfo " id="T2:U131"><span class="var type1" id="S7T3U191">x</span>(<span class="var type1" id="S26T2U192">l</span>,<span class="mxinfo " id="T2:U134">2</span>)</span></span></span> + <span class="mxinfo " id="T2:U135">(<span class="mxinfo " id="T2:U136">-<span class="mxinfo " id="T2:U137">1</span></span>)*<span class="mxinfo " id="T2:U138"><span class="var type1" id="S15T1U199">b</span>(<span class="mxinfo " id="T2:U140">1</span>,<span class="mxinfo " id="T2:U141">1</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        <span class="mxinfo " id="T2:U142"><span class="mxinfo " id="T2:U143"><span class="var type1" id="S17T1U205">hnode</span>(<span class="mxinfo " id="T7:U145">1</span>,<span class="mxinfo " id="T7:U146">2</span>)</span> = <span class="mxinfo " id="T2:U147"><span class="fcn" id="F72N3:B209">f</span>(<span class="mxinfo " id="T2:U148"><span class="mxinfo " id="T2:U149"><span class="mxinfo " id="T2:U150"><span class="mxinfo " id="T2:U151"><span class="var type1" id="S14T6U214">v</span>(<span class="mxinfo " id="T7:U153">1</span>,<span class="mxinfo " id="T7:U154">2</span>)</span>*<span class="mxinfo " id="T2:U155"><span class="var type1" id="S7T3U218">x</span>(<span class="var type1" id="S26T2U219">l</span>,<span class="mxinfo " id="T2:U158">1</span>)</span></span> + <span class="mxinfo " id="T2:U159"><span class="mxinfo " id="T2:U160"><span class="var type1" id="S14T6U223">v</span>(<span class="mxinfo " id="T2:U162">2</span>,<span class="mxinfo " id="T2:U163">2</span>)</span>*<span class="mxinfo " id="T2:U164"><span class="var type1" id="S7T3U227">x</span>(<span class="var type1" id="S26T2U228">l</span>,<span class="mxinfo " id="T2:U167">2</span>)</span></span></span> + <span class="mxinfo " id="T2:U168">(<span class="mxinfo " id="T2:U169">-<span class="mxinfo " id="T2:U170">1</span></span>)*<span class="mxinfo " id="T2:U171"><span class="var type1" id="S15T1U235">b</span>(<span class="mxinfo " id="T2:U173">1</span>,<span class="mxinfo " id="T2:U174">2</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="comment">% calculate output layer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo " id="T2:U175"><span class="mxinfo " id="T2:U176"><span class="var type1" id="S22T4U241">y</span>(<span class="mxinfo " id="T7:U178">1</span>,<span class="var type1" id="S26T2U243">l</span>)</span> = <span class="mxinfo " id="T2:U180"><span class="fcn" id="F72N3:B245">f</span>(<span class="mxinfo " id="T2:U181"><span class="mxinfo " id="T2:U182"><span class="mxinfo " id="T2:U183"><span class="mxinfo " id="T2:U184"><span class="var type1" id="S12T1U250">w</span>(<span class="mxinfo " id="T7:U186">1</span>,<span class="mxinfo " id="T7:U187">1</span>)</span>*<span class="mxinfo " id="T2:U188"><span class="var type1" id="S17T1U254">hnode</span>(<span class="mxinfo " id="T2:U190">1</span>,<span class="mxinfo " id="T2:U191">1</span>)</span></span>+ <span class="mxinfo " id="T2:U192"><span class="mxinfo " id="T2:U193"><span class="var type1" id="S12T1U259">w</span>(<span class="mxinfo " id="T2:U195">1</span>,<span class="mxinfo " id="T2:U196">2</span>)</span>*<span class="mxinfo " id="T2:U197"><span class="var type1" id="S17T1U263">hnode</span>(<span class="mxinfo " id="T2:U199">1</span>,<span class="mxinfo " id="T2:U200">2</span>)</span></span></span> + <span class="mxinfo " id="T2:U201">(<span class="mxinfo " id="T2:U202">-<span class="mxinfo " id="T2:U203">1</span></span>)*<span class="var type1" id="S16T2U270">c</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T2:U205"><span class="var type1" id="S23T2U273">err</span> = <span class="mxinfo " id="T2:U207"><span class="var type1" id="S23T2U275">err</span> + <span class="mxinfo " id="T2:U209"><span class="mxinfo " id="T2:U210">0.5</span>*<span class="mxinfo " id="T2:U211">(<span class="mxinfo " id="T2:U212"><span class="mxinfo " id="T2:U213"><span class="var type1" id="S8T4U282">t</span>(<span class="mxinfo " id="T7:U215">1</span>,<span class="var type1" id="S26T2U284">l</span>)</span>-<span class="mxinfo " id="T2:U217"><span class="var type1" id="S22T4U286">y</span>(<span class="mxinfo " id="T2:U219">1</span>,<span class="var type1" id="S26T2U288">l</span>)</span></span>)^2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">        <span class="mxinfo " id="T2:U221"><span class="var type1" id="S28T2U292">ddd</span> = <span class="mxinfo " id="T2:U223">(<span class="mxinfo " id="T2:U224"><span class="mxinfo " id="T2:U225"><span class="var type1" id="S8T4U297">t</span>(<span class="mxinfo " id="T2:U227">1</span>,<span class="var type1" id="S26T2U299">l</span>)</span>-<span class="mxinfo " id="T2:U229"><span class="var type1" id="S22T4U301">y</span>(<span class="mxinfo " id="T2:U231">1</span>,<span class="var type1" id="S26T2U303">l</span>)</span></span>)*<span class="mxinfo " id="T2:U233"><span class="fcn" id="F100N4:B305">f_prime</span>(<span class="mxinfo " id="T2:U234"><span class="var type1" id="S22T4U307">y</span>(<span class="mxinfo " id="T7:U236">1</span>,<span class="var type1" id="S26T2U309">l</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="comment">% calculate delta_w</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">        <span class="mxinfo " id="T2:U238"><span class="mxinfo " id="T2:U239"><span class="var type1" id="S19T1U313">w_delta</span>(<span class="mxinfo " id="T2:U241">1</span>,<span class="mxinfo " id="T2:U242">1</span>)</span> = <span class="mxinfo " id="T2:U243"><span class="mxinfo " id="T2:U244"><span class="var type1" id="S19T1U318">w_delta</span>(<span class="mxinfo " id="T2:U246">1</span>,<span class="mxinfo " id="T2:U247">1</span>)</span> + <span class="mxinfo " id="T2:U248"><span class="mxinfo " id="T2:U249"><span class="var type1" id="S9T2U323">rate</span>*<span class="mxinfo " id="T2:U251"><span class="var type1" id="S17T1U325">hnode</span>(<span class="mxinfo " id="T2:U253">1</span>,<span class="mxinfo " id="T2:U254">1</span>)</span></span>* <span class="var type1" id="S28T2U328">ddd</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">        <span class="mxinfo " id="T2:U256"><span class="mxinfo " id="T2:U257"><span class="var type1" id="S19T1U332">w_delta</span>(<span class="mxinfo " id="T2:U259">1</span>,<span class="mxinfo " id="T2:U260">2</span>)</span> = <span class="mxinfo " id="T2:U261"><span class="mxinfo " id="T2:U262"><span class="var type1" id="S19T1U337">w_delta</span>(<span class="mxinfo " id="T2:U264">1</span>,<span class="mxinfo " id="T2:U265">2</span>)</span> + <span class="mxinfo " id="T2:U266"><span class="mxinfo " id="T2:U267"><span class="var type1" id="S9T2U342">rate</span>*<span class="mxinfo " id="T2:U269"><span class="var type1" id="S17T1U344">hnode</span>(<span class="mxinfo " id="T2:U271">1</span>,<span class="mxinfo " id="T2:U272">2</span>)</span></span>* <span class="var type1" id="S28T2U347">ddd</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="mxinfo " id="T2:U274"><span class="var type1" id="S25T2U350">c_delta</span>      = <span class="mxinfo " id="T2:U276"><span class="var type1" id="S25T2U352">c_delta</span>      + <span class="mxinfo " id="T2:U278"><span class="mxinfo " id="T2:U279"><span class="var type1" id="S9T2U355">rate</span>*(<span class="mxinfo " id="T2:U281">-<span class="mxinfo " id="T2:U282">1</span></span>)</span>      * <span class="var type1" id="S28T2U359">ddd</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">        <span class="comment">% calculate delta_v</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">        <span class="mxinfo " id="T2:U284"><span class="mxinfo " id="T2:U285"><span class="var type1" id="S20T6U363">v_delta</span>(<span class="mxinfo " id="T2:U287">1</span>,<span class="mxinfo " id="T2:U288">1</span>)</span> = <span class="mxinfo " id="T2:U289"><span class="mxinfo " id="T2:U290"><span class="var type1" id="S20T6U368">v_delta</span>(<span class="mxinfo " id="T2:U292">1</span>,<span class="mxinfo " id="T2:U293">1</span>)</span> + <span class="mxinfo " id="T2:U294"><span class="mxinfo " id="T2:U295"><span class="mxinfo " id="T2:U296"><span class="mxinfo " id="T2:U297"><span class="var type1" id="S9T2U375">rate</span>* <span class="var type1" id="S28T2U376">ddd</span></span> *<span class="mxinfo " id="T2:U300"><span class="var type1" id="S12T1U378">w</span>(<span class="mxinfo " id="T2:U302">1</span>,<span class="mxinfo " id="T2:U303">1</span>)</span></span>*<span class="mxinfo " id="T2:U304"><span class="fcn" id="F100N4:B382">f_prime</span>(<span class="mxinfo " id="T2:U305"><span class="var type1" id="S17T1U384">hnode</span>(<span class="mxinfo " id="T7:U307">1</span>,<span class="mxinfo " id="T7:U308">1</span>)</span>)</span></span>*<span class="mxinfo " id="T2:U309"><span class="var type1" id="S7T3U388">x</span>(<span class="var type1" id="S26T2U389">l</span>,<span class="mxinfo " id="T2:U312">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">        <span class="mxinfo " id="T2:U313"><span class="mxinfo " id="T2:U314"><span class="var type1" id="S20T6U394">v_delta</span>(<span class="mxinfo " id="T2:U316">1</span>,<span class="mxinfo " id="T2:U317">2</span>)</span> = <span class="mxinfo " id="T2:U318"><span class="mxinfo " id="T2:U319"><span class="var type1" id="S20T6U399">v_delta</span>(<span class="mxinfo " id="T2:U321">1</span>,<span class="mxinfo " id="T2:U322">2</span>)</span> + <span class="mxinfo " id="T2:U323"><span class="mxinfo " id="T2:U324"><span class="mxinfo " id="T2:U325"><span class="mxinfo " id="T2:U326"><span class="var type1" id="S9T2U406">rate</span>* <span class="var type1" id="S28T2U407">ddd</span></span> *<span class="mxinfo " id="T2:U329"><span class="var type1" id="S12T1U409">w</span>(<span class="mxinfo " id="T2:U331">1</span>,<span class="mxinfo " id="T2:U332">2</span>)</span></span>*<span class="mxinfo " id="T2:U333"><span class="fcn" id="F100N4:B413">f_prime</span>(<span class="mxinfo " id="T2:U334"><span class="var type1" id="S17T1U415">hnode</span>(<span class="mxinfo " id="T7:U336">1</span>,<span class="mxinfo " id="T7:U337">2</span>)</span>)</span></span>*<span class="mxinfo " id="T2:U338"><span class="var type1" id="S7T3U419">x</span>(<span class="var type1" id="S26T2U420">l</span>,<span class="mxinfo " id="T2:U341">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">        <span class="mxinfo " id="T2:U342"><span class="mxinfo " id="T2:U343"><span class="var type1" id="S20T6U425">v_delta</span>(<span class="mxinfo " id="T2:U345">2</span>,<span class="mxinfo " id="T2:U346">1</span>)</span> = <span class="mxinfo " id="T2:U347"><span class="mxinfo " id="T2:U348"><span class="var type1" id="S20T6U430">v_delta</span>(<span class="mxinfo " id="T2:U350">2</span>,<span class="mxinfo " id="T2:U351">1</span>)</span> + <span class="mxinfo " id="T2:U352"><span class="mxinfo " id="T2:U353"><span class="mxinfo " id="T2:U354"><span class="mxinfo " id="T2:U355"><span class="var type1" id="S9T2U437">rate</span>* <span class="var type1" id="S28T2U438">ddd</span></span> *<span class="mxinfo " id="T2:U358"><span class="var type1" id="S12T1U440">w</span>(<span class="mxinfo " id="T2:U360">1</span>,<span class="mxinfo " id="T2:U361">1</span>)</span></span>*<span class="mxinfo " id="T2:U362"><span class="fcn" id="F100N4:B444">f_prime</span>(<span class="mxinfo " id="T2:U363"><span class="var type1" id="S17T1U446">hnode</span>(<span class="mxinfo " id="T7:U365">1</span>,<span class="mxinfo " id="T7:U366">1</span>)</span>)</span></span>*<span class="mxinfo " id="T2:U367"><span class="var type1" id="S7T3U450">x</span>(<span class="var type1" id="S26T2U451">l</span>,<span class="mxinfo " id="T2:U370">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        <span class="mxinfo " id="T2:U371"><span class="mxinfo " id="T2:U372"><span class="var type1" id="S20T6U456">v_delta</span>(<span class="mxinfo " id="T2:U374">2</span>,<span class="mxinfo " id="T2:U375">2</span>)</span> = <span class="mxinfo " id="T2:U376"><span class="mxinfo " id="T2:U377"><span class="var type1" id="S20T6U461">v_delta</span>(<span class="mxinfo " id="T2:U379">2</span>,<span class="mxinfo " id="T2:U380">2</span>)</span> + <span class="mxinfo " id="T2:U381"><span class="mxinfo " id="T2:U382"><span class="mxinfo " id="T2:U383"><span class="mxinfo " id="T2:U384"><span class="var type1" id="S9T2U468">rate</span>* <span class="var type1" id="S28T2U469">ddd</span></span> *<span class="mxinfo " id="T2:U387"><span class="var type1" id="S12T1U471">w</span>(<span class="mxinfo " id="T2:U389">1</span>,<span class="mxinfo " id="T2:U390">2</span>)</span></span>*<span class="mxinfo " id="T2:U391"><span class="fcn" id="F100N4:B475">f_prime</span>(<span class="mxinfo " id="T2:U392"><span class="var type1" id="S17T1U477">hnode</span>(<span class="mxinfo " id="T7:U394">1</span>,<span class="mxinfo " id="T7:U395">2</span>)</span>)</span></span>*<span class="mxinfo " id="T2:U396"><span class="var type1" id="S7T3U481">x</span>(<span class="var type1" id="S26T2U482">l</span>,<span class="mxinfo " id="T2:U399">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        <span class="mxinfo " id="T2:U400"><span class="mxinfo " id="T2:U401"><span class="var type1" id="S21T1U487">b_delta</span>(<span class="mxinfo " id="T2:U403">1</span>,<span class="mxinfo " id="T2:U404">1</span>)</span> = <span class="mxinfo " id="T2:U405"><span class="mxinfo " id="T2:U406"><span class="var type1" id="S21T1U492">b_delta</span>(<span class="mxinfo " id="T2:U408">1</span>,<span class="mxinfo " id="T2:U409">1</span>)</span> + <span class="mxinfo " id="T2:U410"><span class="mxinfo " id="T2:U411"><span class="mxinfo " id="T2:U412"><span class="mxinfo " id="T2:U413"><span class="var type1" id="S9T2U499">rate</span>* <span class="var type1" id="S28T2U500">ddd</span></span> *<span class="mxinfo " id="T2:U416"><span class="var type1" id="S12T1U502">w</span>(<span class="mxinfo " id="T2:U418">1</span>,<span class="mxinfo " id="T2:U419">1</span>)</span></span>*<span class="mxinfo " id="T2:U420"><span class="fcn" id="F100N4:B506">f_prime</span>(<span class="mxinfo " id="T2:U421"><span class="var type1" id="S17T1U508">hnode</span>(<span class="mxinfo " id="T7:U423">1</span>,<span class="mxinfo " id="T7:U424">1</span>)</span>)</span></span>*(<span class="mxinfo " id="T2:U425">-<span class="mxinfo " id="T2:U426">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">        <span class="mxinfo " id="T2:U427"><span class="mxinfo " id="T2:U428"><span class="var type1" id="S21T1U517">b_delta</span>(<span class="mxinfo " id="T2:U430">1</span>,<span class="mxinfo " id="T2:U431">2</span>)</span> = <span class="mxinfo " id="T2:U432"><span class="mxinfo " id="T2:U433"><span class="var type1" id="S21T1U522">b_delta</span>(<span class="mxinfo " id="T2:U435">1</span>,<span class="mxinfo " id="T2:U436">2</span>)</span> + <span class="mxinfo " id="T2:U437"><span class="mxinfo " id="T2:U438"><span class="mxinfo " id="T2:U439"><span class="mxinfo " id="T2:U440"><span class="var type1" id="S9T2U529">rate</span>* <span class="var type1" id="S28T2U530">ddd</span></span> *<span class="mxinfo " id="T2:U443"><span class="var type1" id="S12T1U532">w</span>(<span class="mxinfo " id="T2:U445">1</span>,<span class="mxinfo " id="T2:U446">2</span>)</span></span>*<span class="mxinfo " id="T2:U447"><span class="fcn" id="F100N4:B536">f_prime</span>(<span class="mxinfo " id="T2:U448"><span class="var type1" id="S17T1U538">hnode</span>(<span class="mxinfo " id="T7:U450">1</span>,<span class="mxinfo " id="T7:U451">2</span>)</span>)</span></span>*(<span class="mxinfo " id="T2:U452">-<span class="mxinfo " id="T2:U453">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">    <span class="comment">% output first-batch error</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T8:U454"><span class="var type1" id="S24T5U548">k</span> == <span class="mxinfo " id="T2:U456">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo " id="T2:U457"><span class="var type1" id="S3T2U552">err_1</span> = <span class="var type1" id="S23T2U553">err</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">    <span class="comment">% count times</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T2:U460"><span class="var type1" id="S6T2U556">times</span> = <span class="mxinfo " id="T2:U462"><span class="var type1" id="S6T2U558">times</span> + <span class="mxinfo " id="T2:U464">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T8:U465"><span class="var type1" id="S23T2U564">err</span> &lt; <span class="var type1" id="S11T2U565">target</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">    <span class="comment">% update v and w</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo " id="T1:U468"><span class="var type1" id="S12T1U569">w</span> = <span class="mxinfo " id="T1:U470"><span class="var type1" id="S12T1U571">w</span> + <span class="var type1" id="S19T1U572">w_delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo " id="T6:U473"><span class="var type1" id="S14T6U575">v</span> = <span class="mxinfo " id="T6:U475"><span class="var type1" id="S14T6U577">v</span> + <span class="var type1" id="S20T6U578">v_delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T1:U478"><span class="var type1" id="S15T1U581">b</span> = <span class="mxinfo " id="T1:U480"><span class="var type1" id="S15T1U583">b</span> + <span class="var type1" id="S21T1U584">b_delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo " id="T2:U483"><span class="var type1" id="S16T2U587">c</span> = <span class="mxinfo " id="T2:U485"><span class="var type1" id="S16T2U589">c</span> + <span class="var type1" id="S25T2U590">c_delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo " id="T2:U488"><span class="var type1" id="S5T2U593">err_final</span> = <span class="var type1" id="S23T2U594">err</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo " id="T1:U491"><span class="var type1" id="S4T1U597">w_final</span> = <span class="var type1" id="S12T1U598">w</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"></span></span>
</pre>
